# Set up notebook
## Load libraries & functions
```{r}
# install.packages("conStruct")
library(here)
library(tidyverse)
library(magrittr)
library(conStruct)
# install.packages("fields")
library(fields)

source("functions.R")
```

## Convert allele data in STRUCTURE format to ConStruct format

Following this guide: https://cran.r-project.org/web/packages/conStruct/vignettes/format-data.html#other-formats-to-construct

- copied populations.structure (structure file) to populations_structure.txt, as recommended
- then deleted first line from .txt file: "# Stacks v2.62;  Structure v2.3; May 05, 2023"

This is the "Allele frequency data".
```{r}
allele_frqs <- conStruct::structure2conStruct(
  infile = here::here("./summary_stats/mmaf0.05_R1_populations_output/populations_structure.txt"),
  onerowperind = FALSE,
  start.loci = 3,
  start.samples = 2,
  missing.datum = -9,
  outfile = here("./clean_data/construct_data_20230529"))

# check dimensions
dim(allele_frqs)
# there are more rows (samples) than columns (loci). This won't do, seeing as I get this error message when I try to use this dataset as-is with the conStruct() function:
# 
# Error in validate.data.block(data.block) : 
# your data must have a greater number of loci than there are samples

# check for rows that are identical
allele_frqs %>%
  as.data.frame() %>%
  duplicated() %>%
  any()
# no rows are identical.
# I'll have to remove 261-183=78 samples to get an equal number of 
# loci and samples... so I'll remove 79 samples to get loci > samples.

```

## Load in other data
### Geographic sampling coordinates
```{r}
# coordinates of all populations
all_coords <- read.csv(here::here("./clean_data/urb_metrics.csv"))

# the populations of this project, in order
pop_map2_IDs <- read.csv(here::here("./genomic_resources/pop_map2.csv")) %>%
  dplyr::rename("sample" = 1,
                "pop_id" = 2) %>%

# add MW IDs to populations that are currently numbers
  add_MW_IDs()

# join coordinates w/current populations
coords <- right_join(all_coords %>%
                      dplyr::select(patch_id, lat, long),
                    pop_map2_IDs %>%
                      dplyr::select(-pop_id),
                    by = "patch_id") %>%
  arrange(sample) %>%
  dplyr::select(long, lat) %>%
  dplyr::rename("Lon" = 1,
                "Lat" = 2) %>%
  as.matrix()
```

### Geographic distance matrix
```{r}
# calculate pairwise great-circle distance between sampling coordinates
distances <- fields::rdist.earth(coords,
                            # distances in km
                            miles = FALSE)
```

# Run spatial model
## Run 1: k = 1, 5,000 iterations, 3 chains- NO WARNINGS!
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the geographic distance matrix (geoDist)
#       the sampling coordinates (coords)

spatial_mod_run1 <- conStruct(spatial = TRUE, 
                    K = 1, 
                    freqs = allele_frqs,
                    geoDist = distances, 
                    coords = coords,
                    prefix = "sp_K1_iter5000_chains3",
                    n.chains = 3,
                    n.iter = 5000)
```

Output:

SAMPLING FOR MODEL 'space_oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.037 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 370 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 5000 [  0%]  (Warmup)
Chain 1: Iteration:  500 / 5000 [ 10%]  (Warmup)
Chain 1: Iteration: 1000 / 5000 [ 20%]  (Warmup)
Chain 1: Iteration: 1500 / 5000 [ 30%]  (Warmup)
Chain 1: Iteration: 2000 / 5000 [ 40%]  (Warmup)
Chain 1: Iteration: 2500 / 5000 [ 50%]  (Warmup)
Chain 1: Iteration: 2501 / 5000 [ 50%]  (Sampling)
Chain 1: Iteration: 3000 / 5000 [ 60%]  (Sampling)
Chain 1: Iteration: 3500 / 5000 [ 70%]  (Sampling)
Chain 1: Iteration: 4000 / 5000 [ 80%]  (Sampling)
Chain 1: Iteration: 4500 / 5000 [ 90%]  (Sampling)
Chain 1: Iteration: 5000 / 5000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1860.2 seconds (Warm-up)
Chain 1:                1726.06 seconds (Sampling)
Chain 1:                3586.26 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'space_oneK' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.041 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 410 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 5000 [  0%]  (Warmup)
Chain 2: Iteration:  500 / 5000 [ 10%]  (Warmup)
Chain 2: Iteration: 1000 / 5000 [ 20%]  (Warmup)
Chain 2: Iteration: 1500 / 5000 [ 30%]  (Warmup)
Chain 2: Iteration: 2000 / 5000 [ 40%]  (Warmup)
Chain 2: Iteration: 2500 / 5000 [ 50%]  (Warmup)
Chain 2: Iteration: 2501 / 5000 [ 50%]  (Sampling)
Chain 2: Iteration: 3000 / 5000 [ 60%]  (Sampling)
Chain 2: Iteration: 3500 / 5000 [ 70%]  (Sampling)
Chain 2: Iteration: 4000 / 5000 [ 80%]  (Sampling)
Chain 2: Iteration: 4500 / 5000 [ 90%]  (Sampling)
Chain 2: Iteration: 5000 / 5000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 3157.86 seconds (Warm-up)
Chain 2:                1668.02 seconds (Sampling)
Chain 2:                4825.89 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'space_oneK' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.036 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 360 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 5000 [  0%]  (Warmup)
Chain 3: Iteration:  500 / 5000 [ 10%]  (Warmup)
Chain 3: Iteration: 1000 / 5000 [ 20%]  (Warmup)
Chain 3: Iteration: 1500 / 5000 [ 30%]  (Warmup)
Chain 3: Iteration: 2000 / 5000 [ 40%]  (Warmup)
Chain 3: Iteration: 2500 / 5000 [ 50%]  (Warmup)
Chain 3: Iteration: 2501 / 5000 [ 50%]  (Sampling)
Chain 3: Iteration: 3000 / 5000 [ 60%]  (Sampling)
Chain 3: Iteration: 3500 / 5000 [ 70%]  (Sampling)
Chain 3: Iteration: 4000 / 5000 [ 80%]  (Sampling)
Chain 3: Iteration: 4500 / 5000 [ 90%]  (Sampling)
Chain 3: Iteration: 5000 / 5000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 2676.28 seconds (Warm-up)
Chain 3:                1619.59 seconds (Sampling)
Chain 3:                4295.87 seconds (Total)
Chain 3: 


# Run non-spatial model (like STRUCTURE)
## Run 1: 4/20/23 (k = 2)- WARNINGS
Took about 2 hours to run.
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run <- conStruct(spatial = FALSE, 
                    K = 2, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK2")
```

Output:

SAMPLING FOR MODEL 'multiK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.035 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 350 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 4184.01 seconds (Warm-up)
Chain 1:                1594.36 seconds (Sampling)
Chain 1:                5778.37 seconds (Total)
Chain 1:

Warning messages:
1: There were 236 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup to find out why this is a problem and how to eliminate them. 
2: Examine the pairs() plot to diagnose sampling problems
3: The largest R-hat is 2.12, indicating chains have not mixed.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#r-hat 
4: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess 
5: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess

## Run 2: (k = 1)- WARNINGS
Took about 15 minutes to run.
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run2 <- conStruct(spatial = FALSE, 
                    K = 1, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK1")
```

Output:

checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 1 layer(s)


SAMPLING FOR MODEL 'oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.049 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 490 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 160.941 seconds (Warm-up)
Chain 1:                180.133 seconds (Sampling)
Chain 1:                341.074 seconds (Total)
Chain 1: 
Warning messages:
1: The largest R-hat is 1.06, indicating chains have not mixed.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#r-hat 
2: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess 
3: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess 

## Run 3: (k = 1), 2000 iterations- WARNINGS
Took about 15 minutes to run.
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run3 <- conStruct(spatial = FALSE, 
                    K = 1, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK1_1",
         # increasing the # of iterations from 1000 to 2000 based on the output from the previous run, which had some warnings that might be alleviated from increasing the number of iterations
                    n.iter = 2000 )
```

Output:

checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 1 layer(s)


SAMPLING FOR MODEL 'oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.064 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 640 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 327.072 seconds (Warm-up)
Chain 1:                382.115 seconds (Sampling)
Chain 1:                709.187 seconds (Total)
Chain 1: 
Warning messages:
1: The largest R-hat is 1.06, indicating chains have not mixed.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#r-hat 
2: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess 
3: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess

## Run 4: (k = 1), 5000 iterations- WARNINGS
Took about 30 minutes to run.
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run4 <- conStruct(spatial = FALSE, 
                    K = 1, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK1_2",
         # increasing the # of iterations from 1000 to 5000 
                    n.iter = 5000 )
```

Output:


checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 1 layer(s)


SAMPLING FOR MODEL 'oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.089 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 890 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 5000 [  0%]  (Warmup)
Chain 1: Iteration:  500 / 5000 [ 10%]  (Warmup)
Chain 1: Iteration: 1000 / 5000 [ 20%]  (Warmup)
Chain 1: Iteration: 1500 / 5000 [ 30%]  (Warmup)
Chain 1: Iteration: 2000 / 5000 [ 40%]  (Warmup)
Chain 1: Iteration: 2500 / 5000 [ 50%]  (Warmup)
Chain 1: Iteration: 2501 / 5000 [ 50%]  (Sampling)
Chain 1: Iteration: 3000 / 5000 [ 60%]  (Sampling)
Chain 1: Iteration: 3500 / 5000 [ 70%]  (Sampling)
Chain 1: Iteration: 4000 / 5000 [ 80%]  (Sampling)
Chain 1: Iteration: 4500 / 5000 [ 90%]  (Sampling)
Chain 1: Iteration: 5000 / 5000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 895.454 seconds (Warm-up)
Chain 1:                918.618 seconds (Sampling)
Chain 1:                1814.07 seconds (Total)
Chain 1: 
Warning message:
Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess 

## Run 5: (k = 1), 10,000 iterations- WARNINGS
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run5 <- conStruct(spatial = FALSE, 
                    K = 1, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK1_3",
         # increasing the # of iterations from 1000 to 10000
                    n.iter = 10000 )
```

Output:

checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 1 layer(s)


SAMPLING FOR MODEL 'oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.041 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 410 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 1: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 1: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 1: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 1: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 1: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 1: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 1: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 1: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 1: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 1: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 1: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 1: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 1: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 1: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 1: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1356.03 seconds (Warm-up)
Chain 1:                1586.16 seconds (Sampling)
Chain 1:                2942.19 seconds (Total)
Chain 1: 
Warning messages:
1: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess 
2: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess 

## Run 6: 4/21/23 (k = 1), 10,000 iterations, 2 chains- WARNINGS
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run6 <- conStruct(spatial = FALSE, 
                    K = 1, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK1_4",
                    n.chains = 2,
                    n.iter = 10000 )
```

Output:

checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 1 layer(s)


SAMPLING FOR MODEL 'oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.094 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 940 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 1: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 1: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 1: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 1: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 1: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 1: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 1: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 1: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 1: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 1: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 1: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 1: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 1: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 1: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 1: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1333.1 seconds (Warm-up)
Chain 1:                1563.41 seconds (Sampling)
Chain 1:                2896.51 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'oneK' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.02 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 200 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 2: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 2: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 2: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 2: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 2: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 2: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 2: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 2: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 2: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 2: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 2: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 2: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 2: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 2: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 2: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1477.82 seconds (Warm-up)
Chain 2:                1945.69 seconds (Sampling)
Chain 2:                3423.51 seconds (Total)
Chain 2: 
Warning message:
Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess 

## Run 7: (k = 1), 10,000 iterations, 5 chains- NO WARNINGS!
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run7 <- conStruct(spatial = FALSE, 
                    K = 1, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK1_5",
                    n.chains = 5,
                    n.iter = 10000 )
```

Output:

checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 1 layer(s)


SAMPLING FOR MODEL 'oneK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.069 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 690 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 1: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 1: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 1: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 1: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 1: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 1: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 1: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 1: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 1: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 1: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 1: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 1: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 1: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 1: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 1: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1397 seconds (Warm-up)
Chain 1:                1877.49 seconds (Sampling)
Chain 1:                3274.5 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'oneK' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.02 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 200 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 2: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 2: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 2: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 2: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 2: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 2: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 2: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 2: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 2: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 2: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 2: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 2: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 2: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 2: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 2: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1327.97 seconds (Warm-up)
Chain 2:                1693.67 seconds (Sampling)
Chain 2:                3021.64 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'oneK' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.021 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 210 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 3: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 3: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 3: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 3: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 3: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 3: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 3: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 3: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 3: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 3: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 3: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 3: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 3: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 3: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 3: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 1424.71 seconds (Warm-up)
Chain 3:                2255.89 seconds (Sampling)
Chain 3:                3680.61 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'oneK' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.024 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 240 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 4: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 4: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 4: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 4: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 4: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 4: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 4: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 4: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 4: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 4: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 4: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 4: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 4: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 4: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 4: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 1603.88 seconds (Warm-up)
Chain 4:                1970.18 seconds (Sampling)
Chain 4:                3574.06 seconds (Total)
Chain 4: 

SAMPLING FOR MODEL 'oneK' NOW (CHAIN 5).
Chain 5: 
Chain 5: Gradient evaluation took 0.022 seconds
Chain 5: 1000 transitions using 10 leapfrog steps per transition would take 220 seconds.
Chain 5: Adjust your expectations accordingly!
Chain 5: 
Chain 5: 
Chain 5: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 5: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 5: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 5: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 5: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 5: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 5: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 5: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 5: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 5: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 5: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 5: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 5: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 5: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 5: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 5: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 5: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 5: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 5: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 5: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 5: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 5: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 5: 
Chain 5:  Elapsed Time: 1589.94 seconds (Warm-up)
Chain 5:                1775.87 seconds (Sampling)
Chain 5:                3365.81 seconds (Total)
Chain 5: 

No warnings!!!!!!!!!!!!!!!!

## Run 8: (k = 2), 10,000 iterations, 5 chains- ERROR
Didn't complete because the output file was too big. Took about 30 hours...
```{r}
#       the number of layers (K)
#       the allele frequency data (freqs)
#       the sampling coordinates (coords)
#
#   if you're running the nonspatial model, 
#       you do not have to specify 
#       the geographic distance matrix (geoDist)

nonspatial_mod_run8 <- conStruct(spatial = FALSE, 
                    K = 2, 
                    freqs = allele_frqs, 
                    geoDist = NULL, 
                    coords = coords,
                    prefix = "nspK2_1",
                    n.chains = 5,
                    n.iter = 10000 )
```

Output:

checking data.block

	reading 261 samples
	reading 1362 loci

checking specified model


user has specified a purely discrete model with 2 layer(s)


SAMPLING FOR MODEL 'multiK' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.292 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2920 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 1: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 1: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 1: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 1: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 1: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 1: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 1: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 1: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 1: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 1: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 1: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 1: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 1: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 1: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 1: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 10706.2 seconds (Warm-up)
Chain 1:                9280.21 seconds (Sampling)
Chain 1:                19986.4 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'multiK' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.037 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 370 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 2: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 2: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 2: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 2: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 2: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 2: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 2: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 2: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 2: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 2: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 2: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 2: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 2: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 2: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 2: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 10139.8 seconds (Warm-up)
Chain 2:                7844.81 seconds (Sampling)
Chain 2:                17984.6 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'multiK' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.038 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 380 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 3: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 3: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 3: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 3: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 3: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 3: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 3: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 3: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 3: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 3: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 3: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 3: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 3: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 3: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 3: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 14586.5 seconds (Warm-up)
Chain 3:                7958.89 seconds (Sampling)
Chain 3:                22545.4 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'multiK' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.039 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 390 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 4: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 4: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 4: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 4: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 4: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 4: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 4: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 4: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 4: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 4: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 4: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 4: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 4: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 4: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 4: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 10817.5 seconds (Warm-up)
Chain 4:                13614.1 seconds (Sampling)
Chain 4:                24431.7 seconds (Total)
Chain 4: 

SAMPLING FOR MODEL 'multiK' NOW (CHAIN 5).
Chain 5: 
Chain 5: Gradient evaluation took 0.034 seconds
Chain 5: 1000 transitions using 10 leapfrog steps per transition would take 340 seconds.
Chain 5: Adjust your expectations accordingly!
Chain 5: 
Chain 5: 
Chain 5: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 5: Iteration:  500 / 10000 [  5%]  (Warmup)
Chain 5: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 5: Iteration: 1500 / 10000 [ 15%]  (Warmup)
Chain 5: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 5: Iteration: 2500 / 10000 [ 25%]  (Warmup)
Chain 5: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 5: Iteration: 3500 / 10000 [ 35%]  (Warmup)
Chain 5: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 5: Iteration: 4500 / 10000 [ 45%]  (Warmup)
Chain 5: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 5: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 5: Iteration: 5500 / 10000 [ 55%]  (Sampling)
Chain 5: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 5: Iteration: 6500 / 10000 [ 65%]  (Sampling)
Chain 5: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 5: Iteration: 7500 / 10000 [ 75%]  (Sampling)
Chain 5: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 5: Iteration: 8500 / 10000 [ 85%]  (Sampling)
Chain 5: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 5: Iteration: 9500 / 10000 [ 95%]  (Sampling)
Chain 5: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 5: 
Chain 5:  Elapsed Time: 10985.4 seconds (Warm-up)
Chain 5:                10905.2 seconds (Sampling)
Chain 5:                21890.6 seconds (Total)
Chain 5: 
Error: cannot allocate vector of size 662.1 Mb
In addition: Warning messages:
1: There were 1181 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. 
2: Examine the pairs() plot to diagnose sampling problems